@page "/"
@using BaseSolution.Application.DataTransferObjects.Film
@using BaseSolution.BlazorServer.Components.Login;
@using BaseSolution.BlazorServer.Data.DataTransferObjects.Film.Request
@using BaseSolution.BlazorServer.Repositories.Interfaces
@using BaseSolution.Domain.Entities
@using BaseSolution.BlazorServer.Components.Film;
@inject IDialogService DialogService
@inject NavigationManager NavigationManager
<MudPaper Style="background-color:#180F20">
    <MudContainer Fixed="true">
        <MudCarousel Style="height:200px;color:#F5F5F5;" ShowArrows="@arrows" ShowBullets="@bullets" EnableSwipeGesture="@enableSwipeGesture" AutoCycle="@autocycle" TData="object">
            <ChildContent>
                @if (_lst == null)
                {
                    <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
                }
                else
                {
                    if (_lst == null)
                    {
                        <MudAlert Severity="Severity.Warning" >Không có dữ liệu</MudAlert>
                    }
                    else
                    {
                        @foreach(var item in _lst)
                        {
                            <MudCarouselItem Transition="transition" Class="ml-3">
                                <MudImage Src="@item.PosterURL" Style="width:97%;height:90%" Alt="Swedish Farm House" Elevation="25" Class="rounded-lg ma-4" />
                            </MudCarouselItem>
                        }
                    }
                }
            </ChildContent>
        </MudCarousel>
        <MudPaper Style="background-color:#09060F;"><MudText Align="Align.Center" Typo="Typo.h3" Class="mt-3" Style="color:#F5F5F5">Phim đang chiếu</MudText></MudPaper>
    @if (_lst == null)
    {
        <MudProgressCircular Color="Color.Primary" Indeterminate="true" />
    }
    else
    {
        if (_lst == null)
        {
            <MudAlert Severity="Severity.Warning" >Không có dữ liệu</MudAlert>
        }
        else
        {
        <MudGrid Class="mt-4 ml-4">
            @foreach(var item in _lst)
            {
                <MudItem xs="3" lg="3" md="3">
                    <MudImage Src="@item.UrlImage" @onclick="OpenDialog" Style="width:70%;" Alt="Swedish Farm House" Elevation="25" Class="rounded-lg ma-4" />
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Tên Phim: @item.Title</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Thời gian : @item.Duration phút</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Ngày chiếu : @item.ReleaseDate.ToString("dd/mm/yyyy")</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Thể loại : @item.Genres</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4"><MudButton @onclick="() => Order(item.Id)" Variant="Variant.Filled" Color="Color.Success" Class="mt-3">Đặt vé</MudButton> </MudText>
                </MudItem>
            }
        </MudGrid>
        <MudPaper Style="background-color:#09060F;"><MudText Align="Align.Center" Typo="Typo.h3" Style="color:#F5F5F5" Class="mt-3">Phim sắp chiếu</MudText></MudPaper>
        <MudGrid Class="mt-4 ml-4">
            @foreach (var item in _lst)
            {
                <MudItem xs="3" lg="3" md="3">
                    <MudImage Src="@item.UrlImage" Style="width:70%;" Alt="Swedish Farm House" Elevation="25" Class="rounded-lg ma-4" />
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Tên Phim: @item.Title</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Thời gian : @item.Duration phút</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4">Ngày chiếu : @item.ReleaseDate.ToString("dd/mm/yyyy")</MudText>
                    <MudText Align="Align.Start" Style="color:#F5F5F5" Class="ml-4 mb-5">Thể loại : @item.Genres</MudText>
                </MudItem>
            }
        </MudGrid>
            }
        }
    </MudContainer>
</MudPaper>
@code {
    public string Search { get; set; }
    // private void OpenDialog()
    // {
    //     DialogOptions closeOnEscapeKey = new DialogOptions() { CloseOnEscapeKey = true };

    //     DialogService.Show<Login>("Đăng nhập", closeOnEscapeKey);
    // }
    [Inject] 
    public IFilmRepositories _film { get; set; }
    public ViewFilmWithPaginationRequest obj = new();
    public List<FilmDto>? _lst{ get; set; }
    private void Order(Guid IdFilm)
    {
        // Chuyển hướng đến trang đặt vé với thông tin phim
        NavigationManager.NavigateTo($"/booking/{IdFilm}");
    }
    private void OpenDialog()
    {
        DialogOptions closeOnEscapeKey = new DialogOptions() { CloseOnEscapeKey = true };

        DialogService.Show<TrailerFilm>("Trailer phim", closeOnEscapeKey);
    }
    private bool arrows = true;
    private bool bullets = true;
    private bool enableSwipeGesture = true;
    private bool autocycle = true;
    private Transition transition = Transition.Slide;
    protected override async Task OnInitializedAsync()
    {
        await LoadData();
    }
    private async Task LoadData()
    {

        var result = await _film.GetAllActive();
        _lst = result.Data.Data.ToList();
    }
}