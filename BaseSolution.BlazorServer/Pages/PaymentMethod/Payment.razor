@page "/payment"
@using BaseSolution.Application.DataTransferObjects.Bill
@using BaseSolution.Application.DataTransferObjects.Department
@using BaseSolution.Application.DataTransferObjects.Film
@using BaseSolution.Application.DataTransferObjects.PaymentMethod
@using BaseSolution.Application.DataTransferObjects.Room
@using BaseSolution.Application.DataTransferObjects.Seat
@using BaseSolution.Application.DataTransferObjects.Transaction
@using BaseSolution.BlazorServer.Components
@using BaseSolution.BlazorServer.Data.Extensions
@using MudBlazor
@using System.Globalization

@inject IDialogService _dialogService
@inject ISnackbar _snackbar
@inject NavigationManager _navigationManager;

<MudAppBar Style="background-color:burlywood" Fixed="false" Elevation="0">
    <MudLink Href="/room"><MudIconButton Icon="@Icons.Material.Filled.ArrowBackIos" Color="Color.Inherit" Edge="Edge.Start" /></MudLink>
    <MudText>Thanh toán</MudText>
    <MudSpacer />
</MudAppBar>

<MudPaper Style="background-color:#180F20;width:auto;height:auto;">
    <MudContainer Fixed="true">
        <MudPaper Square="true" Style="background-color:#180F20">
            <MudGrid>
                <MudItem xs="8" md="8" lg="8" Style="background-color:#B7DEA4;">
                    <MudGrid>
                        <MudItem xs="12" md="12" lg="12" Class="mt-5">
                            <MudText Style="color:white;">THÔNG TIN THANH TOÁN</MudText>
                        </MudItem>
                        <MudItem xs="12" md="12" lg="12">
                            <MudPaper>
                                <MudGrid>
                                    <MudItem xs="4" md="4" Class="ml-5">
                                        <MudText Color="Color.Default">Họ Và Tên: @_transactionDto.CustomerName</MudText>
                                    </MudItem>
                                    <MudItem xs="4" md="4">
                                        <MudText Color="Color.Default">SĐT: @_transactionDto.PhoneNumber</MudText>
                                    </MudItem>
                                    <MudItem xs="3" md="3">
                                        <MudText Color="Color.Default">Email: @_transactionDto.Email</MudText>
                                    </MudItem>
                                </MudGrid>
                            </MudPaper>
                        </MudItem>
                        <MudItem xs="11" lg="11" md="11">
                            <MudText Align="Align.Right" Style="color:#180F20">Tổng tiền: @_transactionDto.Price.ToString("#,##0") vnd</MudText>
                        </MudItem>
                        <MudItem xs="11" lg="11" md="11">
                            <MudText Align="Align.Right" Style="color:#180F20">Số tiền cần thanh toán: @_transactionDto.Price.ToString("#,##0") vnd</MudText>
                        </MudItem>
                        <MudDivider />
                        <MudText Align="Align.Left" Style="color:#180F20;">Phương thức thanh toán</MudText>
                        <MudDivider />
                    </MudGrid>
                    <MudGrid>
                        <MudItem xs="12" md="12" lg="12" Style="color:darkred;">
                            <MudField Label="Chọn thẻ thanh toán" Variant="Variant.Text" InnerPadding="false">
                                <MudSelect T="string" @bind-Value="@SelectedOption">
                                    @foreach(var item in _lst)
                                    {
                                        <MudSelectItem T="string" Style="color:darkred;">@item.Name</MudSelectItem>
                                    }
                                </MudSelect>
                            </MudField>
                        </MudItem>
                    </MudGrid>
                    @if(SelectedOption.Equals("Tiền mặt"))
                    {
                       @*  <paymethod/> *@
                    }
                </MudItem>
                <MudItem xs="4" md="4" lg="4">
                    <MudPaper Style="background-color:#2E0E4A">
                        <MudGrid>
                            <MudItem xs="12" md="12" lg="12">
                                <MudImage Src="@_filmDto.UrlImage" Style="width:90%;height:70%;" Alt="Swedish Farm House" Elevation="1" Class="rounded-lg ma-4" />
                            </MudItem>
                            <MudItem xs="12" md="12" lg="12" Class="ml-3">
                                <MudText Typo="Typo.h6" Style="color:white">Tên phim: @_filmDto.Title</MudText>
                                <MudText Typo="Typo.subtitle1" Style="color:white">Định dạng phim: @_filmDto.Script</MudText>
                            </MudItem>
                            <MudItem xs="12" md="12">
                                <MudText Class="ml-3" Typo="Typo.body1" Style="color:white;"><MudIcon Icon="@Icons.Material.TwoTone.Discount" />Thể Loại: @_filmDto.Genres</MudText>
                                <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.Alarm" />Thời lượng: @_filmDto.Duration phút</MudText>
                                <MudDivider />
                            </MudItem>
                            <MudItem xs="12" md="12" lg="12">
                                <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.AccountBalance" />Rạp chiếu: @_departmentDto.Name</MudText>
                                @foreach (var item in _filmDto.ShowDates)
                                {
                                    <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.CalendarMonth" />Ngày chiếu: @item</MudText>
                                }
                                @foreach (var item in _filmDto.ShowTimes)
                                {
                                    <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.CalendarMonth" />Giờ chiếu: @item</MudText>
                                }
                                <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.Computer" />Phòng chiếu: @_roomDto.Code</MudText>
                                <MudText Class="ml-3" Style="color:white"><MudIcon Icon="@Icons.Material.Filled.EventSeat" />Ghế ngồi: @_seatDto.Code</MudText>
                                <MudDivider />
                            </MudItem>
                            <MudGrid>
                                <MudItem xs="3" lg="3" md="3"></MudItem>
                                <MudItem xs="3" lg="3" md="3">
                                    <MudButton Style="color:white">Quay lại</MudButton>
                                </MudItem>
                                <MudItem xs="3" lg="3" md="3">
                                    <MudButton OnClick="()=>Pay()" Style="color:white">Tiếp tục</MudButton>
                                </MudItem>
                                <MudItem xs="2" lg="2" md="2"></MudItem>
                            </MudGrid>
                        </MudGrid>
                    </MudPaper>
                    <MudGrid/>
                </MudItem>
            </MudGrid>
        </MudPaper>
    </MudContainer>
</MudPaper>
@code {
    // private async Task CreateDialog()
    // {
    //     DialogOptions closeOnEscapeKey = new DialogOptions() { CloseOnEscapeKey = true };

    //     _dialogService.Show<paymethod>("Số tiền cần thanh toán", closeOnEscapeKey);
    // }
    public string SelectedOption { get; set; }

    private void Reset()
    {
        SelectedOption = null;
    }
    TransactionDto _transactionDto = new()
    {
            CustomerName = "A",
            PhoneNumber = "0123456789",
            Price = 150000,
            Email = "A2@gmail.com",
            Code = "2A",
    };
    List<PaymentMethodDto> _lst = new()
    {
        new PaymentMethodDto(){Name="VNPay"},
        new PaymentMethodDto(){Name="AiPay"},
        new PaymentMethodDto(){Name="BMPay"},
        new PaymentMethodDto(){Name="Tiền mặt"},
    };
    FilmDto _filmDto = new()
    {
        UrlImage="https://media.loveitopcdn.com/3807/co-viet-nam-qua-cac-thoi-ky01.png",
        Title="Daddy",
        Script="2D lồng tiếng",
        Genres="Hành động",
        Duration="150",
        ShowDates = new()
        {
            DateTime.UtcNow
        },
        ShowTimes = new()
        {
            DateTime.UtcNow
        }
    };
    DepartmentDto _departmentDto = new()
    {
        Name="Thanh xuân có mấy"
    };
    RoomDto _roomDto = new()
    {
        Code="Phòng bố"
    };
    SeatDto _seatDto = new()
    {
        Code="A1"
    };
    private void Pay()
    {
        // Chuyển hướng đến trang đặt vé với thông tin phim
        _navigationManager.NavigateTo($"/pay/method");
    }
}
